<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tài liệu Tinh gọn</title>
    <style>

    :root { --primary: #f59e0b; --text: #451a03; }
    html { scroll-behavior: smooth; }
    body { font-family: "Quicksand", sans-serif; line-height: 1.8; color: var(--text); max-width: 1100px; margin: 0 auto; padding: 3rem 5%; background: #fffcf2; }
    article { background: #ffffff; padding: 50px; border-radius: 30px; border: 1px solid #fef3c7; }
    h1 { font-size: 2.8rem; color: #92400e; text-align: center; margin-bottom: 3rem; }
    h2 { font-size: 1.7rem; color: #b45309; margin-top: 3rem; background: #fef3c7; padding: 10px 25px; border-radius: 15px; display: inline-block; }
    
    img { 
      max-width: 100% !important; 
      height: auto !important; 
      object-fit: contain !important;
      border-radius: 20px; 
      box-shadow: 0 10px 25px rgba(245, 158, 11, 0.1); 
      margin: 3rem auto; 
      display: block;
      border: 4px solid #fff;
    }

    mjx-container[display="true"], .math.display {
      background: #fffbeb;
      padding: 1.5rem;
      border-radius: 20px;
      border: 2px dashed #fde68a;
      margin: 2rem 0;
    }
    mjx-container:not([display="true"]), .math:not(.display) {
      background: transparent !important;
      border: none !important;
      padding: 0 !important;
      display: inline-block;
      margin: 0 !important;
      box-shadow: none !important;
    }

    pre { background: #2d3748; color: #fff; padding: 25px; border-radius: 20px; }
    .toc { background: #fffbeb; border: 3px solid #f59e0b; padding: 2rem; border-radius: 25px; }
  
    </style>
    
  <script>
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      displayMath: [['$$', '$$'], ['\\[', '\\]']],
      processEscapes: true,
      processEnvironments: true,
      processRefs: true,
      tags: 'ams'
    },
    options: {
      renderActions: {
        addMenu: []
      },
      ignoreHtmlClass: 'tex2jax_ignore',
      processHtmlClass: 'tex2jax_process'
    },
    chtml: {
      displayAlign: 'center',
      displayIndent: '0'
    }
  };
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

</head>
<body class="tex2jax_process">
    <article class="tex2jax_process">
<section class="tex2jax_ignore mathjax_ignore tex2jax_process" id="chuong-2-du-bao-tuyen-tinh-xu-huong-va-dong-luong">
<h1 id="chuong-2-du-bao-tuyen-tinh-xu-huong-va-dong-luong-0">Chương 2: Dự báo Tuyến tính, Xu hướng và Động lượng</h1>

    <nav class="toc">
        <div class="toc-title">Mục lục</div>
        <ul>
            <li class="toc-level-1"><a href="#chuong-2-du-bao-tuyen-tinh-xu-huong-va-dong-luong-0">Chương 2: Dự báo Tuyến tính, Xu hướng và Động lượng</a></li><li class="toc-level-2"><a href="#cach-su-dung-so-tay-nay-1">Cách sử dụng Sổ tay này</a></li><li class="toc-level-2"><a href="#du-bao-bang-hoi-quy-tuyen-tinh-lr--2">Dự báo bằng Hồi quy Tuyến tính (LR)</a></li><li class="toc-level-3"><a href="#cac-gia-dinh-gauss-markov-3">Các giả định Gauss Markov</a></li><li class="toc-level-3"><a href="#vi-du-1-hoi-quy-tuyen-tinh-don-bien-cho-gia-co-phi-4">Ví dụ 1: Hồi quy tuyến tính đơn biến cho giá cổ phiếu Netflix</a></li><li class="toc-level-3"><a href="#vi-du-2-du-bao-don-bien-su-dung-du-lieu-khi-hau-je-5">Ví dụ 2. Dự báo đơn biến sử dụng Dữ liệu Khí hậu Jena</a></li><li class="toc-level-3"><a href="#vi-du-3-hoi-quy-tuyen-tinh-da-bien-va-cac-ky-thuat-6">Ví dụ 3: Hồi quy tuyến tính đa biến và các kỹ thuật điều chuẩn (Regularization)</a></li><li class="toc-level-3"><a href="#dieu-chuan-l1-lasso-va-l2-ridge-cho-hoi-quy-tuyen--7">Điều chuẩn L1 (Lasso) và L2 (Ridge) cho hồi quy tuyến tính đa biến</a></li><li class="toc-level-3"><a href="#vi-du-4-hoi-quy-tuyen-tinh-da-bien-tren-du-lieu-kh-8">Ví dụ 4: Hồi quy tuyến tính đa biến trên Dữ liệu Khí hậu Jena</a></li><li class="toc-level-2"><a href="#du-bao-dong-luong-va-xu-huong-9">Dự báo Động lượng và Xu hướng</a></li><li class="toc-level-3"><a href="#duong-trung-binh-dong-moving-average-ma--10">Đường trung bình động (Moving Average - MA)</a></li><li class="toc-level-3"><a href="#vi-du-5-trich-xuat-xu-huong-trong-du-lieu-khi-hau--11">Ví dụ 5: Trích xuất xu hướng trong Dữ liệu Khí hậu bằng MA</a></li><li class="toc-level-3"><a href="#chien-luoc-dong-luong-momentum-strategies--12">Chiến lược Động lượng (Momentum Strategies)</a></li><li class="toc-level-3"><a href="#vi-du-6-chien-luoc-giao-dich-dong-luong-su-dung-ha-13">Ví dụ 6: Chiến lược giao dịch Động lượng sử dụng hai đường MA</a></li><li class="toc-level-3"><a href="#vi-du-7-chien-luoc-giao-dich-dong-luong-su-dung-ma-14">Ví dụ 7: Chiến lược giao dịch Động lượng sử dụng MACD</a></li>
        </ul>
    </nav>
<p>Biên soạn bởi: Marissa P. Liponhay and Maria Eloisa M. Ventura</p>
<p>Trong chương này, chúng tôi giới thiệu các công cụ cơ bản về dự báo, những công cụ sử dụng công thức đại số đơn giản. Ở chương trước, chúng ta đã thảo luận về ARIMA, nơi các giá trị tương lai của một chuỗi thời gian được dự báo bằng cách sử dụng các giá trị quá khứ hoặc giá trị trễ của nó. Chúng ta đã thấy rằng ARIMA chỉ có thể được áp dụng sau khi đã loại bỏ xu hướng và tính thời vụ của dữ liệu. Tuy nhiên, chúng tôi lưu ý rằng đối với một số công cụ dự báo, xu hướng là yếu tố có liên quan và là một phần của công thức dự đoán. Trong phần này, việc dự báo sẽ được trình diễn trong khi tận dụng các mối quan hệ và xu hướng trong dữ liệu.</p>
<p>Trong nửa đầu của sổ tay này, chúng tôi trình diễn việc dự báo bằng cách khớp dữ liệu chuỗi thời gian với hồi quy tuyến tính. Đối với nửa sau, chúng tôi chứng minh rằng bằng cách sử dụng các xu hướng của dữ liệu chuỗi thời gian như trung bình trượt, chúng ta có thể dự đoán hướng đi tương lai có thể có của xu hướng bằng cách sử dụng dự báo động lượng.</p>
<p>Cuối cùng, một điều quan trọng cần lưu ý là khái niệm trung bình trượt (MA) trong ARIMA không giống với khái niệm trong chương này, vì trung bình trượt sẽ được thảo luận ở đây chỉ là định nghĩa cổ điển của MA.</p>
<section id="cach-su-dung-so-tay-nay">
<h2 id="cach-su-dung-so-tay-nay-1">Cách sử dụng Sổ tay này</h2>
<p>Chương này được chia thành hai phần chính về: (a) hồi quy tuyến tính và (b) dự báo xu hướng và động lượng bằng cách sử dụng trung bình trượt. Trong mỗi phần, lý thuyết được thảo luận trước, sau đó là các ví dụ được triển khai bằng Python 3. Đề cương chương có thể được xem trong tệp <strong><span class="xref myst">readme</span></strong> của chương này.</p>
</section>
<section id="du-bao-bang-hoi-quy-tuyen-tinh-lr" class="tex2jax_process">
<h2 id="du-bao-bang-hoi-quy-tuyen-tinh-lr--2">Dự báo bằng Hồi quy Tuyến tính (LR)</h2>
<p>Dự báo bằng hồi quy tuyến tính được sử dụng khi dự báo một chuỗi thời gian y, với giả định rằng nó có mối quan hệ tuyến tính với một chuỗi thời gian x khác.</p>
<p class="tex2jax_process">Phương trình cơ bản khi thực hiện hồi quy tuyến tính là:
<span class="math notranslate nohighlight tex2jax_process">\(y= mx + b \)</span></p>
<p class="tex2jax_process">Trong đó <span class="math notranslate nohighlight tex2jax_process">\(m\)</span> à hệ số góc (độ dốc) của đường thẳng khớp và <span class="math notranslate nohighlight tex2jax_process">\(b\)</span> là điểm giao cắt với trục <span class="math notranslate nohighlight tex2jax_process">\(y\)</span> , đại diện cho sai số trong việc khớp dữ liệu. Thông thường trong dự báo, <span class="math notranslate nohighlight tex2jax_process">\(y\)</span> được thay thế bằng <span class="math notranslate nohighlight tex2jax_process">\(\hat{y}\)</span> để tượng trưng cho giá trị dự báo.</p>
<p class="tex2jax_process">Dựa trên một tập dữ liệu, người ta có thể dễ dàng tính toán hệ số góc của dữ liệu theo cách thủ công hoặc tự động bằng các hàm đường xu hướng (trendline) tích hợp sẵn trong Excel. Để tính toán <span class="math notranslate nohighlight tex2jax_process">\(m\)</span> thủ công, phương trình sau đây được sử dụng:</p>
<p class="tex2jax_process"><span class="math notranslate nohighlight tex2jax_process">\(m = {\frac{\sum\limits _{i=1} ^{n}(x_{i}-\bar{x})(y_{i}-\bar{y})}{\sum\limits _{i=1} ^{n}(x_{i}-\bar{x})^2}}\)</span></p>
<p>Để tính toán tự động trong Excel, người ta chỉ cần đặt một ‘đường xu hướng’ tuyến tính vào biểu đồ phân tán của dữ liệu.</p>
<p>Phương pháp này được gọi là Bình phương tối thiểu thông thường (OLS). Một phương trình tổng quát hơn của hồi quy tuyến tính sử dụng OLS được cho là:</p>
<p class="tex2jax_process"><span class="math notranslate nohighlight tex2jax_process">\(y= mx + b + \mu_{i}\)</span></p>
<p class="tex2jax_process">Trong đó <span class="math notranslate nohighlight tex2jax_process">\(\mu_{i}\)</span> đại diện cho các giá trị ngoại lai hoặc các số hạng không thể khớp vào đường hồi quy.</p>
<p>OLS định lượng việc đánh giá các đường hồi quy khác nhau. Sử dụng OLS, đường hồi quy nào tối thiểu hóa tổng bình phương của sự chênh lệch giữa biến phụ thuộc quan sát được và biến phụ thuộc dự đoán sẽ được chọn là đường khớp nhất.</p>
<p>Nhưng điều gì sẽ xảy ra nếu có các giá trị ngoại lai khiến cho đường hồi quy tốt nhất bởi OLS không thực sự khớp với dữ liệu? Điều này dẫn chúng ta đến việc kiểm tra xem khi nào OLS có thể được áp dụng cho một tập dữ liệu. Sau đây là các giả định cần thiết phải được đáp ứng trước khi chúng ta có thể áp dụng OLS.</p>
<section id="cac-gia-dinh-gauss-markov" class="tex2jax_process">
<h3 id="cac-gia-dinh-gauss-markov-3">Các giả định Gauss Markov</h3>
<p>Các giả định sau đây đối với dữ liệu mẫu (từ một quần thể) cần phải được đáp ứng để các tham số được tính toán bằng OLS thực sự đại diện cho ước lượng không chệch tốt nhất của các tham số quần thể.</p>
<ol class="arabic simple tex2jax_process">
<li class="tex2jax_process"><p class="tex2jax_process">Tính tuyến tính trong các tham số: Giả định này yêu cầu tham số <span class="math notranslate nohighlight tex2jax_process">\(m\)</span> phải là tuyến tính. (Biến độc lập không bắt buộc phải tuyến tính).</p></li>
<li class="tex2jax_process"><p class="tex2jax_process">Cả biến độc lập và biến phụ thuộc <span class="math notranslate nohighlight tex2jax_process">\((x,y)\)</span> đều là các biến ngẫu nhiên: Điều này sẽ dẫn đến việc số hạng ngoại lai hoặc số hạng phần dư có tự tương quan bằng không.</p></li>
<li class="tex2jax_process"><p class="tex2jax_process">Đối với phương pháp hồi quy đa biến, không nên có hiện tượng đa cộng tuyến hoàn hảo giữa các biến độc lập. Để kiểm tra sự hiện diện của đa cộng tuyến, <span class="math notranslate nohighlight tex2jax_process">\(R^{2}\)</span> là một chỉ số tốt.</p></li>
<li class="tex2jax_process"><p class="tex2jax_process">Số hạng ngoại lai (còn gọi là số hạng phần dư) <span class="math notranslate nohighlight tex2jax_process">\(\mu\)</span> là nội sinh, sao cho <span class="math notranslate nohighlight tex2jax_process">\(cov(\mu_{i}, x_{i})=0\)</span>.</p></li>
<li class="tex2jax_process"><p class="tex2jax_process">Tính đồng nhất của phương sai (Homoscedasticity) trong số hạng phần dư <span class="math notranslate nohighlight tex2jax_process">\(\mu_{i}\)</span>, nói cách khác, phương sai của <span class="math notranslate nohighlight tex2jax_process">\(\mu_{i}\)</span> độc lập với <span class="math notranslate nohighlight tex2jax_process">\(x_{i}\)</span>.</p></li>
<li class="tex2jax_process"><p class="tex2jax_process">Số hạng phần dư <span class="math notranslate nohighlight tex2jax_process">\(\mu_{i}\)</span> không có tự tương quan, nghĩa là <span class="math notranslate nohighlight tex2jax_process">\(cov(\mu_{i}, \mu_{j})=0\)</span>.</p></li>
</ol>
<p class="tex2jax_process">Sử dụng OLS cho dữ liệu chuỗi thời gian, các mẫu được rút ra từ cùng một quá trình, và chúng ta không còn có thể giả định rằng biến độc lập <span class="math notranslate nohighlight tex2jax_process">\(x\)</span> là biến ngẫu nhiên. Trong trường hợp này, các giả định (4-6) phải được đáp ứng nghiêm ngặt bởi tất cả <span class="math notranslate nohighlight tex2jax_process">\(x\)</span> tại mọi thời điểm.</p>
</section>
<section id="vi-du-1-hoi-quy-tuyen-tinh-don-bien-cho-gia-co-phieu-netflix" class="tex2jax_process">
<h3 id="vi-du-1-hoi-quy-tuyen-tinh-don-bien-cho-gia-co-phi-4">Ví dụ 1: Hồi quy tuyến tính đơn biến cho giá cổ phiếu Netflix</h3>
<p>Hồi quy tuyến tính là một trong những công cụ thành công nhất được sử dụng trong phân tích kỹ thuật về giá và được cung cấp rộng rãi như một công cụ lập biểu đồ. Để phục vụ mục đích minh họa, chúng ta sẽ sử dụng dữ liệu lịch sử của Netflix được tải xuống từ Yahoo.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.linear_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">LinearRegression</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pandas.plotting</span><span class="w"> </span><span class="kn">import</span> <span class="n">autocorrelation_plot</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">statsmodels.api</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sm</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.graphics</span><span class="w"> </span><span class="kn">import</span> <span class="n">tsaplots</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">r2_score</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn</span><span class="w"> </span><span class="kn">import</span> <span class="n">metrics</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="c1">#from sklearn.model_selection </span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">price</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">'../data/NFLX3.csv'</span><span class="p">,</span><span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="s1">'Date'</span><span class="p">,</span> <span class="s1">'Close'</span><span class="p">],</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="s1">'Date'</span><span class="p">])</span>
<span class="n">price</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">"Date"</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">"figure.figsize"</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">=</span><span class="n">price</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Price'</span><span class="p">)</span>
<span class="c1"># plt.grid()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">'Daily Close Price'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="images/5b24bde99f14423334e0cf74b3ce7620795fdfade664f6b73575643d0993f90f.png" src="images/5b24bde99f14423334e0cf74b3ce7620795fdfade664f6b73575643d0993f90f.png" style="max-width: 100%; height: auto; display: block;">
</div>
</div>
<section id="kiem-tra-tinh-dung" class="tex2jax_process">
<h4>Kiểm tra tính dừng</h4>
<p>Chúng ta đã học từ chương trước rằng một trong những bước đầu tiên cần làm khi thực hiện dự báo chuỗi thời gian là kiểm tra tính dừng của dữ liệu, đặc biệt là khi có một xu hướng nổi bật. Trong sổ tay này, chúng ta sẽ sử dụng kiểm định thống kê phổ biến nhất được gọi là Kiểm định Augmented Dickey-Fuller (ADF), một loại kiểm định nghiệm đơn vị (unit root test). Lưu ý rằng kiểm định nghiệm đơn vị xác định mức độ mạnh mẽ của một xu hướng trong việc định hình chuỗi thời gian. Kiểm định này sử dụng một mô hình tự hồi quy và tối ưu hóa tiêu chuẩn thông tin qua các giá trị độ trễ khác nhau. Hãy nhớ lại rằng:</p>
<p>Giả thuyết không (H0):</p>
<ul class="simple">
<li><p>Chuỗi thời gian có nghiệm đơn vị và không dừng. Nó phụ thuộc vào thời gian.</p></li>
</ul>
<p>Giả thuyết đối (H1):</p>
<ul class="simple">
<li><p>Chuỗi thời gian không có nghiệm đơn vị và có tính dừng. Nó không phụ thuộc vào thời gian.</p></li>
</ul>
<p>Cuối cùng, kết quả của kiểm định có thể được diễn giải bằng Thống kê ADF, cụ thể là: giá trị thống kê ADF phải nhỏ hơn các giá trị tới hạn (critical values) để dữ liệu được coi là dừng.</p>
<p class="tex2jax_process">Trong một số tài liệu tham khảo, người ta sử dụng giá trị <span class="math notranslate nohighlight tex2jax_process">\(p\)</span> (p-value) từ kiểm định. Giá trị <span class="math notranslate nohighlight tex2jax_process">\(p\)</span> dưới một ngưỡng (chẳng hạn như 5% hoặc 1%) ngụ ý chuỗi thời gian có tính dừng, nếu không thì dữ liệu là không dừng.</p>
<p>p-value &lt;= 0.05: Chuỗi thời gian có tính dừng.</p>
<p>p-value &gt; 0.05: Chuỗi thời gian không dừng.</p>
<p>Trong các tài liệu khác, họ chỉ đơn giản so sánh thống kê ADF với các giá trị tới hạn; nếu thống kê này lớn hơn các giá trị tới hạn, chuỗi thời gian được cho là không dừng.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.tsa.stattools</span><span class="w"> </span><span class="kn">import</span> <span class="n">adfuller</span>
<span class="n">series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">'../data/NFLX3.csv'</span><span class="p">,</span><span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="s1">'Close'</span><span class="p">])</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">values</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">adfuller</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'ADF Statistic: </span><span class="si">%f</span><span class="s1">'</span> <span class="o">%</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'p-value: </span><span class="si">%f</span><span class="s1">'</span> <span class="o">%</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'Critical Values:'</span><span class="p">)</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">result</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
	<span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="se">\t</span><span class="si">%s</span><span class="s1">: </span><span class="si">%.3f</span><span class="s1">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ADF Statistic: -0.027586
p-value: 0.956190
Critical Values:
	1%: -3.446
	5%: -2.868
	10%: -2.570
</pre></div>
</div>
</div>
</div>
<p>Dựa trên kết quả, chuỗi thời gian là không dừng ở tất cả các mức ý nghĩa (1%,…) vì thống kê ADF lớn hơn các giá trị tới hạn.</p>
</section>
<section id="kiem-tra-tu-tuong-quan" class="tex2jax_process">
<h4>Kiểm tra Tự tương quan</h4>
<p class="tex2jax_process">Hệ số tự tương quan đo lường mức độ mạnh yếu của mối quan hệ giữa dữ liệu và các giá trị trễ của chính nó. Hệ số thứ nhất đo lường mối quan hệ giữa <span class="math notranslate nohighlight tex2jax_process">\(y_{t}\)</span> và <span class="math notranslate nohighlight tex2jax_process">\(y_{t-1}\)</span>, trong khi hệ số thứ hai đo lường mối quan hệ giữa <span class="math notranslate nohighlight tex2jax_process">\(y_{t}\)</span> và <span class="math notranslate nohighlight tex2jax_process">\(y_{t-2}\)</span>, và cứ tiếp tục như vậy.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># testing autocorrelation using pandas tools.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">"figure.figsize"</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">tsaplots</span><span class="o">.</span><span class="n">plot_acf</span><span class="p">(</span><span class="n">price</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="images/240abbbc31cb56d540bd325b361988594099cbfc3bcfc2d3c75a86a7f5545a2b.png" src="images/240abbbc31cb56d540bd325b361988594099cbfc3bcfc2d3c75a86a7f5545a2b.png" style="max-width: 100%; height: auto; display: block;">
</div>
</div>
<p>Một cách khác để trực quan hóa sự tự tương quan theo độ trễ bằng cách sử dụng các công cụ của thư viện pandas được trình bày dưới đây.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">"figure.figsize"</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">autocorrelation_plot</span><span class="p">(</span><span class="n">price</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f8505d7fd60&gt;
</pre></div>
</div>
<img alt="images/72d83500dd5cc7b4395877a43158b0fa1a1cbaf0322d5d8311f7ea365c4c56b8.png" src="images/72d83500dd5cc7b4395877a43158b0fa1a1cbaf0322d5d8311f7ea365c4c56b8.png" style="max-width: 100%; height: auto; display: block;">
</div>
</div>
<p>Người ta có thể hình dung rõ hơn về khái niệm tự tương quan trễ nếu chúng ta coi dữ liệu trễ như một phiên bản dịch chuyển của dữ liệu gốc và quan sát sự trùng khớp (trong trường hợp này là sự tự tương quan của chúng). Nếu các xu hướng của dữ liệu gốc đều đi lên hoặc đi xuống khi dữ liệu trễ được dịch chuyển, thì tương quan là dương, ngược lại là âm.</p>
<p class="tex2jax_process">Quay lại với biểu đồ tự tương quan theo độ trễ, biểu đồ cho thấy khi độ trễ tăng lên, xu hướng sẽ giảm xuống. Mối quan hệ mạnh mẽ của dữ liệu với 100 độ trễ đầu tiên cho thấy <span class="math notranslate nohighlight tex2jax_process">\(y\)</span> không hoàn toàn ngẫu nhiên như đã nêu trong giả định Gauss-Markov. Tại độ trễ xấp xỉ 120 ngày, sự tự tương quan bằng không và bắt đầu chuyển sang giá trị âm. Điều này là do xu hướng của dữ liệu trễ trở nên tiêu cực, trái ngược với xu hướng tích cực của dữ liệu gốc.</p>
<p class="tex2jax_process">Ở đây chúng ta thấy rằng sau khoảng <span class="math notranslate nohighlight tex2jax_process">\(y_{t-320}\)</span>, sự tự tương quan bằng không. Điều này chủ yếu là do phần chồng lấp giữa dữ liệu trễ và dữ liệu gốc là tối thiểu khi ngày càng ít dữ liệu được chồng khớp với nhau.</p>
<p>Bây giờ, giả sử rằng các giả định từ 4 đến 6 đã được đáp ứng, chúng ta sẽ áp dụng hồi quy tuyến tính cho giá của cổ phiếu NFLX để dự báo giá hàng ngày cho tháng tiếp theo.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Let us create another variable to manipulate rather than using the original data </span>

<span class="n">window</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">price2</span> <span class="o">=</span> <span class="n">price</span><span class="p">[[</span><span class="s1">'Close'</span><span class="p">]]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">"figure.figsize"</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">price2</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="c1"># plt.grid()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f8505dae0d0&gt;
</pre></div>
</div>
<img alt="images/89b2df110f25cc328689f7065341d9b14880b7a742589fe452ace21fa78d10fb.png" src="images/89b2df110f25cc328689f7065341d9b14880b7a742589fe452ace21fa78d10fb.png" style="max-width: 100%; height: auto; display: block;">
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># With the goal of predicting the future prices daily for a month (30days), we create a variable to contain the size</span>
<span class="c1"># it will be placed at the end of a variable 'Prediction' in the dataframe that is shifted by 30 days</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">"figure.figsize"</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">price2</span><span class="p">[</span><span class="s1">'Prediction'</span><span class="p">]</span> <span class="o">=</span> <span class="n">price2</span><span class="p">[[</span><span class="s1">'Close'</span><span class="p">]]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="n">window</span><span class="p">)</span>

<span class="n">price2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subplots</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="images/4e8fed92567d0b08f2352d1c41a2646850fadb059fb2ea5cba6de50f052f7947.png" src="images/4e8fed92567d0b08f2352d1c41a2646850fadb059fb2ea5cba6de50f052f7947.png" style="max-width: 100%; height: auto; display: block;">
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">price2</span><span class="p">[[</span><span class="s1">'Close'</span><span class="p">]]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(443, 1)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">price2</span><span class="p">[[</span><span class="s1">'Prediction'</span><span class="p">]]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(443, 1)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Now we will use the original data on prices as X, the predicted data as y and use 80% of the data as training set </span>
<span class="c1"># while 20% of the data as test set and use sklearn function to train and test the data.</span>
<span class="c1"># for both variables, the last 30 values are removed.</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">price2</span><span class="p">[[</span><span class="s1">'Close'</span><span class="p">]])</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:</span><span class="o">-</span><span class="n">window</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">))</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">price2</span><span class="p">[</span><span class="s1">'Prediction'</span><span class="p">])</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[:</span><span class="o">-</span><span class="n">window</span><span class="p">]</span>
<span class="c1">#print(y)</span>

<span class="n">x_train</span><span class="p">,</span> <span class="n">x_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">2020</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>413
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(413, 1)
</pre></div>
</div>
</div>
</div>
<p>Bây giờ dữ liệu đã sẵn sàng để huấn luyện và khớp mô hình hồi quy tuyến tính bằng cách sử dụng thư viện sklearn.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
<span class="n">fit</span> <span class="o">=</span> <span class="n">lr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">y_train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(330,)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## coefficients of linear fit are:</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">fit</span><span class="o">.</span><span class="n">intercept_</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">fit</span><span class="o">.</span><span class="n">coef_</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"the equation of the linear fit is: "</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'y= '</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="s1">'x + '</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

<span class="c1"># checking R^2</span>
<span class="n">R_sqd</span> <span class="o">=</span> <span class="n">lr</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">x_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"lr confidence: "</span><span class="p">,</span> <span class="n">R_sqd</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>the equation of the linear fit is: 
y=  [0.98010473] x +  17.065244311865058
lr confidence:  0.720499481096278
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># To show the relationship of the training set and the predicted prices.. we plot the following.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">"figure.figsize"</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="s1">'o'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'x_train'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'y_train'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_train</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_train</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">'regression line'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7f8505d23640&gt;
</pre></div>
</div>
<img alt="images/e93bfd8c566fc0de4b674b44e9f8f283304e4bdb5d7cf7990face8670c2ddc55.png" src="images/e93bfd8c566fc0de4b674b44e9f8f283304e4bdb5d7cf7990face8670c2ddc55.png" style="max-width: 100%; height: auto; display: block;">
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Here is an attempt to show that the difference between the training set and the predicted values are almost Gaussian</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">"figure.figsize"</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_train</span><span class="p">)</span><span class="o">-</span><span class="n">y_train</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">125</span><span class="p">,</span> <span class="mi">126</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="images/f72390e8dce687c80ac56e00c60fb9f5d733d6db415d3492eb6905e2c6021114.png" src="images/f72390e8dce687c80ac56e00c60fb9f5d733d6db415d3492eb6905e2c6021114.png" style="max-width: 100%; height: auto; display: block;">
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setting the last 30 rows of the original Close price as test data </span>
<span class="c1"># to predict the next values. </span>
<span class="n">x_forecast</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">price2</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">'Prediction'</span><span class="p">],</span><span class="mi">1</span><span class="p">))[</span><span class="o">-</span><span class="n">window</span><span class="p">:]</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_forecast</span><span class="p">))</span>

<span class="c1"># # we predict the closing prices...</span>
<span class="n">lr_prediction</span> <span class="o">=</span> <span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_forecast</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lr_prediction</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>30
30
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">"figure.figsize"</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="s1">'o'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'x_test'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'y_test'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_test</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_test</span><span class="p">))</span>
<span class="c1"># plt.legend()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x7f850cd21e50&gt;]
</pre></div>
</div>
<img alt="images/eca11596ca710a1a8f210374e1066a123b61a2b5f58afa3dd06e6a72b6dd7582.png" src="images/eca11596ca710a1a8f210374e1066a123b61a2b5f58afa3dd06e6a72b6dd7582.png" style="max-width: 100%; height: auto; display: block;">
</div>
</div>
<p>Bây giờ, chúng ta thử vẽ biểu đồ các giá trị dự báo đè lên chuỗi thời gian gốc.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">15</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">price2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">price2</span><span class="o">.</span><span class="n">Prediction</span><span class="o">.</span><span class="n">isnull</span><span class="p">()]</span><span class="o">.</span><span class="n">Close</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">'y_train'</span><span class="p">)</span>
<span class="n">price2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">price2</span><span class="o">.</span><span class="n">Prediction</span><span class="o">.</span><span class="n">isnull</span><span class="p">()]</span><span class="o">.</span><span class="n">Close</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">'y_test'</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">price2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">price2</span><span class="o">.</span><span class="n">Prediction</span><span class="o">.</span><span class="n">isnull</span><span class="p">()][[</span><span class="s1">'Close'</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="p">),</span> 
          <span class="n">index</span><span class="o">=</span><span class="n">price2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">price2</span><span class="o">.</span><span class="n">Prediction</span><span class="o">.</span><span class="n">isnull</span><span class="p">()]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> 
          <span class="n">name</span><span class="o">=</span><span class="s1">'Pred_LR'</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">'y_pred from regression'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7f850a7bde20&gt;
</pre></div>
</div>
<img alt="images/909774e7920109dece6c49da1ad71628dbc152a59980c2a0b4e8ff5bffc0d835.png" src="images/909774e7920109dece6c49da1ad71628dbc152a59980c2a0b4e8ff5bffc0d835.png" style="max-width: 100%; height: auto; display: block;">
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># checking R^2</span>
<span class="n">R_sqd_train</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_pred</span><span class="o">=</span><span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_train</span><span class="p">),</span> <span class="n">y_true</span><span class="o">=</span><span class="n">y_train</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Train set R^2: "</span><span class="p">,</span> <span class="n">R_sqd_train</span><span class="p">)</span>

<span class="c1">## R^2 of the predicted vs the actual closing price...</span>
<span class="n">R_sqd_test</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_pred</span><span class="o">=</span><span class="n">lr_prediction</span><span class="p">,</span> <span class="n">y_true</span><span class="o">=</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="n">window</span><span class="p">:])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Test set R^2: "</span><span class="p">,</span> <span class="n">R_sqd_test</span><span class="p">)</span>

<span class="c1"># checking for the MAE values:</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"The mean absolute error, MAE is: "</span><span class="p">,</span> <span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">lr_prediction</span><span class="p">,</span> <span class="n">x_forecast</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Train set R^2:  0.7682299277930607
Test set R^2:  0.9187750163794522
The mean absolute error, MAE is:  6.973973107834884
</pre></div>
</div>
</div>
</div>
</section>
<section id="so-sanh-voi-mo-hinh-trong-do-x-x-t-1" class="tex2jax_process">
<h4 class="tex2jax_process">So sánh với mô hình trong đó <span class="math notranslate nohighlight tex2jax_process">\(X=X_{t-1}\)</span></h4>
<p class="tex2jax_process">Tại đây, chúng ta kiểm tra giá trị <span class="math notranslate nohighlight tex2jax_process">\(R^2\)</span> đối với chuỗi trễ.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">r2_score</span><span class="p">(</span><span class="n">price</span><span class="o">.</span><span class="n">Close</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">price</span><span class="o">.</span><span class="n">Close</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.9814904294769093
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setting the last 30 rows of the original Close price as the variable x_forecast2 and using it as the </span>
<span class="c1"># test data to predict the next values. </span>

<span class="n">x_forecast2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">price2</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">'Prediction'</span><span class="p">],</span><span class="mi">1</span><span class="p">))[</span><span class="o">-</span><span class="n">window</span><span class="p">:]</span>
<span class="c1"># print(len(x_forecast))</span>

<span class="c1"># # we predict the closing prices...</span>
<span class="n">lr_prediction2</span> <span class="o">=</span> <span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_forecast2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lr_prediction</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>30
</pre></div>
</div>
</div>
</div>
<p>Bây giờ chúng ta kiểm tra mối quan hệ giữa dữ liệu kiểm tra và giá trị dự báo, chúng ta thấy rằng có một mối quan hệ tuyến tính hoàn hảo như được hiển thị bên dưới.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">scipy</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">linregress</span>
<span class="n">slope</span><span class="p">,</span> <span class="n">intercept</span><span class="p">,</span> <span class="n">r_value</span><span class="p">,</span> <span class="n">p_value</span><span class="p">,</span> <span class="n">std_err</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span><span class="n">x_forecast</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">lr_prediction2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">"figure.figsize"</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_forecast2</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">lr_prediction2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x7f850d10bfd0&gt;]
</pre></div>
</div>
<img alt="images/d9426ee1c9a76097c5616308fe88fa621cc7ff29fad4df60c75b470585f6aa95.png" src="images/d9426ee1c9a76097c5616308fe88fa621cc7ff29fad4df60c75b470585f6aa95.png" style="max-width: 100%; height: auto; display: block;">
</div>
</div>
</section>
</section>
<section id="vi-du-2-du-bao-don-bien-su-dung-du-lieu-khi-hau-jena" class="tex2jax_process">
<h3 id="vi-du-2-du-bao-don-bien-su-dung-du-lieu-khi-hau-je-5">Ví dụ 2. Dự báo đơn biến sử dụng Dữ liệu Khí hậu Jena</h3>
<p>Chúng ta sẽ sử dụng các giá trị nhiệt độ của dữ liệu trong phần này của chương để xem liệu chúng ta có thể dự báo các giá trị nhiệt độ trong 24 giờ tới hay không. Đối với cuốn sách này, dữ liệu đã được chia thành chuỗi huấn luyện (training_series), chuỗi kiểm định (validation_series) và chuỗi kiểm tra (test_series) như đã mô tả trong lời nói đầu. Trong chương này, tôi không cần thực hiện bất kỳ quy trình kiểm định nào, do đó tôi sẽ kết hợp chuỗi huấn luyện và chuỗi kiểm định để làm dữ liệu thô. Sau đó, chúng ta sẽ thực hiện theo các bước đã được phác thảo trong Ví dụ 1 và xem xét chỉ số MAE trung bình của dự báo khi sử dụng hồi quy tuyến tính.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># combining the training and validation data sets used in this Jupyter book as our training set in this chapter </span>
<span class="c1"># since I don't need to perform validation.</span>
<span class="n">df</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"../data/train_series.csv"</span><span class="p">)</span>
<span class="n">df2</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"../data/val_series.csv"</span><span class="p">)</span>

<span class="c1">## (training + validation series)</span>
<span class="n">df3</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">,</span> <span class="n">df2</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="c1">#train</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df2</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="c1">#val</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df3</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="c1">#combined</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(35045, 15)
(17524, 15)
(52569, 15)
</pre></div>
</div>
</div>
</div>
<p>Bây giờ, chúng ta chọn dữ liệu nhiệt độ và sử dụng nó để dự báo hồi quy tuyến tính đơn biến, đồng thời trực quan hóa dữ liệu thô. Chúng ta giữ cho tập dữ liệu huấn luyện là một bội số của 24.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">len_train</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df3</span><span class="p">)</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">df3</span><span class="p">)</span><span class="o">%</span><span class="k">24</span>
<span class="n">len_train</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>52560
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#using the temperature data</span>
<span class="n">temperature</span> <span class="o">=</span> <span class="n">df3</span><span class="p">[[</span><span class="s1">'T (degC)'</span><span class="p">]]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">len_train</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">"figure.figsize"</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">=</span><span class="n">temperature</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'temp'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">'Hourly Temp'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="images/b58a42a172759fb87900f9567c47c73dfcfd8987183ac53c871010373c3745df.png" src="images/b58a42a172759fb87900f9567c47c73dfcfd8987183ac53c871010373c3745df.png" style="max-width: 100%; height: auto; display: block;">
</div>
</div>
<p>Để thực hiện hồi quy tuyến tính, chúng ta làm theo các bước tương tự như trong Ví dụ 1. Chúng ta sẽ sử dụng dữ liệu nhiệt độ được dịch chuyển (24 giờ) (biến x) làm biến dự đoán (biến y). Chúng ta thu được phương trình bằng cách khớp với LR và sử dụng phương trình đó để dự báo nhiệt độ trong 24 giờ tiếp theo.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">window</span> <span class="o">=</span> <span class="mi">24</span>
<span class="n">temperature</span><span class="p">[</span><span class="s1">'Prediction'</span><span class="p">]</span> <span class="o">=</span> <span class="n">temperature</span><span class="p">[[</span><span class="s1">'T (degC)'</span><span class="p">]]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="n">window</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df4</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"../data/test_series.csv"</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="s1">'T (degC)'</span><span class="p">])</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">17520</span><span class="p">]</span>
<span class="n">test_24</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">df4</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">730</span><span class="p">)))</span>
<span class="c1"># y_test = df4[['T (degC)']].iloc[:24]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">temperature</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">'Prediction'</span><span class="p">],</span><span class="mi">1</span><span class="p">))</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:</span><span class="o">-</span><span class="n">window</span><span class="p">]</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">temperature</span><span class="p">[</span><span class="s1">'Prediction'</span><span class="p">])</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[:</span><span class="o">-</span><span class="n">window</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(52536, 1)
(52536,)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(52536,)
</pre></div>
</div>
</div>
</div>
<section id="du-bao-dong-thoi-nhiet-do-trong-24-gio-toi" class="tex2jax_process">
<h4>Dự báo đồng thời nhiệt độ trong 24 giờ tới</h4>
<p class="tex2jax_process">Để thực hiện dự báo cho 24 giờ tiếp theo, chúng ta sẽ cần thay đổi cấu trúc (reshape) dữ liệu <span class="math notranslate nohighlight tex2jax_process">\(X\)</span> và <span class="math notranslate nohighlight tex2jax_process">\(y\)</span> sao cho có thể chỉ sử dụng một điểm mẫu <span class="math notranslate nohighlight tex2jax_process">\(X\)</span> duy nhất để dự báo nhiệt độ cho toàn bộ 24 giờ kế tiếp.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Divide training data into 24 hour chunks</span>
<span class="c1"># Use 1 Temperature measurement to predict the next 24 hours</span>
<span class="n">X_new</span> <span class="o">=</span> <span class="n">temperature</span><span class="p">[</span><span class="s1">'T (degC)'</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="o">-</span><span class="n">window</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">24</span><span class="p">)[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y_new</span> <span class="o">=</span> <span class="n">temperature</span><span class="p">[</span><span class="s1">'Prediction'</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="o">-</span><span class="n">window</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">24</span><span class="p">)</span>
<span class="n">X_new</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">y_new</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>((2189, 1), (2189, 24))
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">X_new</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[-4.5 ]
 [-4.45]
 [-2.46]
 ...
 [ 0.86]
 [-3.54]
 [-8.26]]
</pre></div>
</div>
</div>
</div>
<p>Chúng ta tạo một vectơ để chứa các kết quả đầu ra của quá trình khớp mô hình.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr_vectoroutput</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
<span class="n">fit</span> <span class="o">=</span> <span class="n">lr_vectoroutput</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_new</span><span class="p">,</span> <span class="n">y_new</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Bây giờ, chúng ta chia dữ liệu kiểm tra thành các khối 24 giờ, những khối này sẽ đóng vai trò là các tập kiểm tra của chúng ta. MAE trung bình của các tập kiểm tra này sẽ được tính toán để xem Hồi quy tuyến tính (LR) đơn biến hoạt động như thế nào trong việc dự báo nhiệt độ cho 24 giờ tới.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">temperature</span><span class="p">[</span><span class="s1">'T (degC)'</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="n">window</span><span class="p">:]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                    <span class="n">test_24</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span><span class="p">])[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">test_24</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## predict for every 24 hrs in test_series</span>
<span class="n">MAE</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">lr_vectoroutput</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_test</span><span class="p">)):</span>
    <span class="n">MAE</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">y_pred</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"The average Mean Absolute Error is for </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">y_test</span><span class="p">)</span><span class="si">}</span><span class="s2"> sets of 24-hr data: "</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">MAE</span><span class="p">)</span><span class="o">/</span><span class="mi">730</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The average Mean Absolute Error is for 730 sets of 24-hr data:  9.067496890754962
</pre></div>
</div>
</div>
</div>
<p>Chúng ta thấy rằng MAE trung bình là 9.067496890754962, điều này cho thấy LR không phải là một mô hình tốt để dự báo nhiệt độ trong 24 giờ tới khi sử dụng Dữ liệu Khí hậu Jena.</p>
</section>
</section>
<section id="vi-du-3-hoi-quy-tuyen-tinh-da-bien-va-cac-ky-thuat-dieu-chuan-regularization">
<h3 id="vi-du-3-hoi-quy-tuyen-tinh-da-bien-va-cac-ky-thuat-6">Ví dụ 3: Hồi quy tuyến tính đa biến và các kỹ thuật điều chuẩn (Regularization)</h3>
<p>Trong ví dụ trước, chúng ta đã sử dụng hồi quy tuyến tính (LR) đơn biến để minh họa việc dự báo chuỗi thời gian. Trong ví dụ này, chúng tôi muốn trình diễn LR cho trường hợp có nhiều hơn một biến độc lập, được gọi là hồi quy tuyến tính đa biến. Để bắt đầu, chúng tôi sẽ trình diễn mô hình LR trước bằng cách sử dụng một bộ dữ liệu đơn giản về xe hơi được tải xuống từ một trong các tài liệu tham khảo. Lưu ý rằng đây chưa phải là dự báo chuỗi thời gian, mà chỉ là một minh họa đơn giản về cách thức hoạt động của LR đa biến.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#creating dataframe for simple data on cars</span>
<span class="n">cars</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">'../data/cars.csv'</span><span class="p">)</span>
<span class="n">cars</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Car</th>
      <th>Model</th>
      <th>Volume</th>
      <th>Weight</th>
      <th>CO2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Toyoty</td>
      <td>Aygo</td>
      <td>1000</td>
      <td>790</td>
      <td>99</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Mitsubishi</td>
      <td>Space Star</td>
      <td>1200</td>
      <td>1160</td>
      <td>95</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Skoda</td>
      <td>Citigo</td>
      <td>1000</td>
      <td>929</td>
      <td>95</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Fiat</td>
      <td>500</td>
      <td>900</td>
      <td>865</td>
      <td>90</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Mini</td>
      <td>Cooper</td>
      <td>1500</td>
      <td>1140</td>
      <td>105</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cars</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Volume</th>
      <th>Weight</th>
      <th>CO2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>36.000000</td>
      <td>36.000000</td>
      <td>36.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>1611.111111</td>
      <td>1292.277778</td>
      <td>102.027778</td>
    </tr>
    <tr>
      <th>std</th>
      <td>388.975047</td>
      <td>242.123889</td>
      <td>7.454571</td>
    </tr>
    <tr>
      <th>min</th>
      <td>900.000000</td>
      <td>790.000000</td>
      <td>90.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>1475.000000</td>
      <td>1117.250000</td>
      <td>97.750000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>1600.000000</td>
      <td>1329.000000</td>
      <td>99.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>2000.000000</td>
      <td>1418.250000</td>
      <td>105.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>2500.000000</td>
      <td>1746.000000</td>
      <td>120.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.linear_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">LinearRegression</span>

<span class="c1"># We will model C02 emission (as y variable) using the parameters volume and weight as predictors (x variable)</span>
<span class="c1"># for a multi-variate linear regression</span>

<span class="n">params</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'Volume'</span><span class="p">,</span> <span class="s1">'Weight'</span><span class="p">]</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">cars</span><span class="p">[</span><span class="n">params</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">cars</span><span class="p">[</span><span class="s1">'CO2'</span><span class="p">]</span>

<span class="c1"># fitting the data with linear regression</span>
<span class="n">lrm</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">lrm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="c1"># coefficients of the fit are as follows:</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">intercept_</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">coef_</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"Using Multivariate Linear Regression, we have the following equation: "</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'CO2= '</span><span class="p">,</span> <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">'x1 + '</span><span class="p">,</span> <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">'x2 + '</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

<span class="c1">#We want to predict CO2 emission given specific weight and volume -- both 1000</span>
<span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">([[</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">]])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Using Multivariate Linear Regression, we have the following equation: 
CO2=  0.007805257527747122 x1 +  0.007550947270300685 x2 +  79.6947192911594
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([95.05092409])
</pre></div>
</div>
</div>
</div>
<section id="giai-thich-cac-he-so">
<h4>Giải thích các hệ số:</h4>
<p>Hệ số góc cho thể tích và trọng lượng của xe lần lượt bằng 0.00781 và 0.00755. Điều này có nghĩa là với mỗi 1 đơn vị thay đổi về thể tích (trọng lượng) của xe, lượng khí thải CO2 dự kiến sẽ tăng thêm 0.00781% (0.00755%).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">lrm</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">'Mean Absolute Error:'</span><span class="p">,</span> <span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean Absolute Error: 5.67040550265231
</pre></div>
</div>
</div>
</div>
</section>
<section id="giai-thich-cac-chi-so">
<h4>Giải thích các chỉ số:</h4>
<p>Chúng ta có thể thấy rằng giá trị sai số tuyệt đối trung bình (MAE) là 5.67, nhỏ hơn 6% so với giá trị trung bình của lượng khí thải CO2. Điều này có nghĩa là dự đoán của chúng ta đạt kết quả tốt.</p>
<p>Đối với hồi quy tuyến tính đa biến, đôi khi chúng ta không biết tham số nào trong số các tham số là có liên quan đến việc dự báo. Vì vậy, để giúp các dự báo chính xác hơn, chúng ta cần xử phạt (penalize) các tham số ít liên quan hơn (về cơ bản là giảm ảnh hưởng của chúng đối với các dự báo của chúng ta và đôi khi để chúng tiến dần về không). Điều này thường được thực hiện bằng cách sử dụng các kỹ thuật điều chuẩn (regularization).</p>
</section>
</section>
<section id="dieu-chuan-l1-lasso-va-l2-ridge-cho-hoi-quy-tuyen-tinh-da-bien">
<h3 id="dieu-chuan-l1-lasso-va-l2-ridge-cho-hoi-quy-tuyen--7">Điều chuẩn L1 (Lasso) và L2 (Ridge) cho hồi quy tuyến tính đa biến</h3>
<p>Các kỹ thuật điều chuẩn dựa trên ý tưởng rằng việc ràng buộc một cách thích hợp các giá trị được phép của các biến sẽ làm tăng độ chính xác. Trong sổ tay này, chúng ta sẽ sử dụng hai kỹ thuật:</p>
<section id="dieu-chuan-lasso-lasso-regularization">
<h4>Điều chuẩn Lasso (Lasso Regularization)</h4>
<ul class="simple">
<li><p>Kỹ thuật này đặt các ràng buộc lên giá trị tuyệt đối của các hệ số.</p></li>
</ul>
</section>
<section id="dieu-chuan-ridge-ridge-regularization">
<h4>Điều chuẩn Ridge (Ridge Regularization)</h4>
<ul class="simple">
<li><p>Kỹ thuật này đặt các ràng buộc lên bình phương của các hệ số.</p></li>
</ul>
</section>
<section id="l1-dieu-chuan">
<h4>L1 Điều chuẩn</h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Lasso Regularization... alpha=0 is equivalent to linear regression</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.linear_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">Lasso</span>
<span class="n">lassoreg</span> <span class="o">=</span> <span class="n">Lasso</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">model3</span> <span class="o">=</span> <span class="n">lassoreg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>


<span class="c1"># coefficients of the fit are as follows:</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">model3</span><span class="o">.</span><span class="n">intercept_</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">model3</span><span class="o">.</span><span class="n">coef_</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"Using Multivariate Linear Regression, we have the following equation: "</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'CO2= '</span><span class="p">,</span> <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">'x1 + '</span><span class="p">,</span> <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">'x2 + '</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Using Multivariate Linear Regression, we have the following equation: 
CO2=  0.007716758354774066 x1 +  0.007406759259298172 x2 +  80.02363225450095
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred</span> <span class="o">=</span> <span class="n">lassoreg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'Mean Absolute Error:'</span><span class="p">,</span> <span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean Absolute Error: 5.65574080048904
</pre></div>
</div>
</div>
</div>
</section>
<section id="l2-dieu-chuan">
<h4>L2 Điều chuẩn</h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ridge Regularization... alpha=0 is equivalent to linear regression</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.linear_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">Ridge</span>
<span class="n">ridgereg</span> <span class="o">=</span> <span class="n">Ridge</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">model2</span> <span class="o">=</span> <span class="n">ridgereg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="c1"># coefficients of the fit are as follows:</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">model2</span><span class="o">.</span><span class="n">intercept_</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">model2</span><span class="o">.</span><span class="n">coef_</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"Using Multivariate Linear Regression, we have the following equation: "</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'CO2= '</span><span class="p">,</span> <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">'x1 + '</span><span class="p">,</span> <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">'x2 + '</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Using Multivariate Linear Regression, we have the following equation: 
CO2=  0.007019810017740837 x1 +  0.007728894654883425 x2 +  80.73020505101513
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn</span><span class="w"> </span><span class="kn">import</span> <span class="n">metrics</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">ridgereg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">'Mean Absolute Error:'</span><span class="p">,</span> <span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean Absolute Error: 5.610220319986732
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="vi-du-4-hoi-quy-tuyen-tinh-da-bien-tren-du-lieu-khi-hau-jena" class="tex2jax_process">
<h3 id="vi-du-4-hoi-quy-tuyen-tinh-da-bien-tren-du-lieu-kh-8">Ví dụ 4: Hồi quy tuyến tính đa biến trên Dữ liệu Khí hậu Jena</h3>
<p class="tex2jax_process">Trong phần này, chúng ta sử dụng dữ liệu khí hậu để minh họa việc dự báo bằng hồi quy tuyến tính đa biến và các kỹ thuật điều chuẩn. Ý tưởng của phương pháp dự báo trong ví dụ này khác với phương pháp đã sử dụng trong Ví dụ 1. Ở Ví dụ 1, chúng ta đã sử dụng giá trị trễ của giá đóng cửa NFLX, tức là chúng ta dự báo <span class="math notranslate nohighlight tex2jax_process">\(y_{T,t}\)</span> bằng cách sử dụng giá trị trễ <span class="math notranslate nohighlight tex2jax_process">\(y_{T-30}\)</span>. Trong ví dụ này, chúng ta sẽ sử dụng các biến khác nhau <span class="math notranslate nohighlight tex2jax_process">\(x_{1,t}\)</span>, <span class="math notranslate nohighlight tex2jax_process">\(x_{2,t}\)</span>,…, <span class="math notranslate nohighlight tex2jax_process">\(x_{n,t}\)</span>, trong đó <span class="math notranslate nohighlight tex2jax_process">\(n\)</span> là tổng số các biến được sử dụng để dự báo <span class="math notranslate nohighlight tex2jax_process">\(y\)</span>. Trong trường hợp cụ thể này, <span class="math notranslate nohighlight tex2jax_process">\(n=14\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">'../data/train_series_datetime.csv'</span><span class="p">,</span><span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">val_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">'../data/val_series_datetime.csv'</span><span class="p">,</span><span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">train_df</span><span class="p">,</span> <span class="n">val_df</span><span class="p">])</span>
<span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date Time</th>
      <th>p (mbar)</th>
      <th>T (degC)</th>
      <th>Tpot (K)</th>
      <th>Tdew (degC)</th>
      <th>rh (%)</th>
      <th>VPmax (mbar)</th>
      <th>VPact (mbar)</th>
      <th>VPdef (mbar)</th>
      <th>sh (g/kg)</th>
      <th>H2OC (mmol/mol)</th>
      <th>rho (g/m**3)</th>
      <th>wv (m/s)</th>
      <th>max. wv (m/s)</th>
      <th>wd (deg)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>01.01.2009 00:10:00</td>
      <td>996.52</td>
      <td>-8.02</td>
      <td>265.40</td>
      <td>-8.90</td>
      <td>93.3</td>
      <td>3.33</td>
      <td>3.11</td>
      <td>0.22</td>
      <td>1.94</td>
      <td>3.12</td>
      <td>1307.75</td>
      <td>1.03</td>
      <td>1.75</td>
      <td>152.3</td>
    </tr>
    <tr>
      <th>6</th>
      <td>01.01.2009 01:10:00</td>
      <td>996.50</td>
      <td>-7.62</td>
      <td>265.81</td>
      <td>-8.30</td>
      <td>94.8</td>
      <td>3.44</td>
      <td>3.26</td>
      <td>0.18</td>
      <td>2.04</td>
      <td>3.27</td>
      <td>1305.68</td>
      <td>0.18</td>
      <td>0.63</td>
      <td>166.5</td>
    </tr>
    <tr>
      <th>12</th>
      <td>01.01.2009 02:10:00</td>
      <td>996.63</td>
      <td>-8.85</td>
      <td>264.57</td>
      <td>-9.70</td>
      <td>93.5</td>
      <td>3.12</td>
      <td>2.92</td>
      <td>0.20</td>
      <td>1.82</td>
      <td>2.93</td>
      <td>1312.11</td>
      <td>0.16</td>
      <td>0.50</td>
      <td>158.3</td>
    </tr>
    <tr>
      <th>18</th>
      <td>01.01.2009 03:10:00</td>
      <td>996.87</td>
      <td>-8.84</td>
      <td>264.56</td>
      <td>-9.69</td>
      <td>93.5</td>
      <td>3.13</td>
      <td>2.92</td>
      <td>0.20</td>
      <td>1.83</td>
      <td>2.93</td>
      <td>1312.37</td>
      <td>0.07</td>
      <td>0.25</td>
      <td>129.3</td>
    </tr>
    <tr>
      <th>24</th>
      <td>01.01.2009 04:10:00</td>
      <td>997.05</td>
      <td>-9.23</td>
      <td>264.15</td>
      <td>-10.25</td>
      <td>92.2</td>
      <td>3.03</td>
      <td>2.79</td>
      <td>0.24</td>
      <td>1.74</td>
      <td>2.80</td>
      <td>1314.62</td>
      <td>0.10</td>
      <td>0.38</td>
      <td>203.9</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
<span class="c1"># print(data.shape)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>p (mbar)</th>
      <th>T (degC)</th>
      <th>Tpot (K)</th>
      <th>Tdew (degC)</th>
      <th>rh (%)</th>
      <th>VPmax (mbar)</th>
      <th>VPact (mbar)</th>
      <th>VPdef (mbar)</th>
      <th>sh (g/kg)</th>
      <th>H2OC (mmol/mol)</th>
      <th>rho (g/m**3)</th>
      <th>wv (m/s)</th>
      <th>max. wv (m/s)</th>
      <th>wd (deg)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>52569.000000</td>
      <td>52569.000000</td>
      <td>52569.000000</td>
      <td>52569.000000</td>
      <td>52569.000000</td>
      <td>52569.000000</td>
      <td>52569.000000</td>
      <td>52569.000000</td>
      <td>52569.000000</td>
      <td>52569.000000</td>
      <td>52569.000000</td>
      <td>52569.000000</td>
      <td>52569.000000</td>
      <td>52569.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>988.705288</td>
      <td>9.194491</td>
      <td>283.277435</td>
      <td>4.788269</td>
      <td>76.393381</td>
      <td>13.377285</td>
      <td>9.463628</td>
      <td>3.913601</td>
      <td>5.980737</td>
      <td>9.573651</td>
      <td>1216.601158</td>
      <td>2.142079</td>
      <td>3.538136</td>
      <td>173.890127</td>
    </tr>
    <tr>
      <th>std</th>
      <td>8.175879</td>
      <td>8.536547</td>
      <td>8.606957</td>
      <td>6.921408</td>
      <td>16.456302</td>
      <td>7.581065</td>
      <td>4.201507</td>
      <td>4.735824</td>
      <td>2.666735</td>
      <td>4.252759</td>
      <td>40.422708</td>
      <td>1.531838</td>
      <td>2.313626</td>
      <td>87.475968</td>
    </tr>
    <tr>
      <th>min</th>
      <td>914.100000</td>
      <td>-23.010000</td>
      <td>250.600000</td>
      <td>-25.010000</td>
      <td>14.200000</td>
      <td>0.950000</td>
      <td>0.790000</td>
      <td>0.000000</td>
      <td>0.500000</td>
      <td>0.800000</td>
      <td>1059.510000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>983.740000</td>
      <td>3.140000</td>
      <td>277.290000</td>
      <td>0.130000</td>
      <td>65.690000</td>
      <td>7.660000</td>
      <td>6.170000</td>
      <td>0.810000</td>
      <td>3.890000</td>
      <td>6.240000</td>
      <td>1187.930000</td>
      <td>1.000000</td>
      <td>1.780000</td>
      <td>121.800000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>989.130000</td>
      <td>9.340000</td>
      <td>283.450000</td>
      <td>5.220000</td>
      <td>79.700000</td>
      <td>11.760000</td>
      <td>8.860000</td>
      <td>2.100000</td>
      <td>5.600000</td>
      <td>8.970000</td>
      <td>1213.250000</td>
      <td>1.780000</td>
      <td>3.000000</td>
      <td>196.800000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>994.040000</td>
      <td>15.310000</td>
      <td>289.390000</td>
      <td>10.030000</td>
      <td>89.700000</td>
      <td>17.420000</td>
      <td>12.320000</td>
      <td>5.170000</td>
      <td>7.790000</td>
      <td>12.460000</td>
      <td>1242.850000</td>
      <td>2.880000</td>
      <td>4.760000</td>
      <td>234.200000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>1012.840000</td>
      <td>35.650000</td>
      <td>309.590000</td>
      <td>23.110000</td>
      <td>100.000000</td>
      <td>58.340000</td>
      <td>28.320000</td>
      <td>42.120000</td>
      <td>18.130000</td>
      <td>28.820000</td>
      <td>1392.100000</td>
      <td>13.590000</td>
      <td>21.580000</td>
      <td>360.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Để nhất quán với tất cả các mô hình dự báo khác, chúng ta sẽ thiết lập thủ công hơn 300.000 dữ liệu đầu tiên làm tập huấn luyện (training set), trong khi hơn 100.000 điểm dữ liệu cuối cùng sẽ được dùng làm tập kiểm tra (test set).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_train</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(52569, 15)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x_train</span> <span class="o">=</span> <span class="n">data_train</span><span class="p">[[</span><span class="s1">'p (mbar)'</span><span class="p">,</span> <span class="s1">'Tpot (K)'</span><span class="p">,</span> <span class="s1">'Tdew (degC)'</span><span class="p">,</span> <span class="s1">'H2OC (mmol/mol)'</span><span class="p">,</span> <span class="s1">'rh (%)'</span><span class="p">,</span> <span class="s1">'VPmax (mbar)'</span><span class="p">,</span> <span class="s1">'VPact (mbar)'</span><span class="p">,</span> <span class="s1">'VPdef (mbar)'</span><span class="p">,</span> <span class="s1">'sh (g/kg)'</span><span class="p">,</span> <span class="s1">'rho (g/m**3)'</span><span class="p">,</span> <span class="s1">'wv (m/s)'</span><span class="p">,</span> <span class="s1">'max. wv (m/s)'</span><span class="p">,</span> <span class="s1">'wd (deg)'</span><span class="p">]]</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">data_train</span><span class="p">[</span><span class="s1">'T (degC)'</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_train</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>p (mbar)</th>
      <th>T (degC)</th>
      <th>Tpot (K)</th>
      <th>Tdew (degC)</th>
      <th>rh (%)</th>
      <th>VPmax (mbar)</th>
      <th>VPact (mbar)</th>
      <th>VPdef (mbar)</th>
      <th>sh (g/kg)</th>
      <th>H2OC (mmol/mol)</th>
      <th>rho (g/m**3)</th>
      <th>wv (m/s)</th>
      <th>max. wv (m/s)</th>
      <th>wd (deg)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>996.52</td>
      <td>-8.02</td>
      <td>265.40</td>
      <td>-8.90</td>
      <td>93.3</td>
      <td>3.33</td>
      <td>3.11</td>
      <td>0.22</td>
      <td>1.94</td>
      <td>3.12</td>
      <td>1307.75</td>
      <td>1.03</td>
      <td>1.75</td>
      <td>152.3</td>
    </tr>
    <tr>
      <th>6</th>
      <td>996.50</td>
      <td>-7.62</td>
      <td>265.81</td>
      <td>-8.30</td>
      <td>94.8</td>
      <td>3.44</td>
      <td>3.26</td>
      <td>0.18</td>
      <td>2.04</td>
      <td>3.27</td>
      <td>1305.68</td>
      <td>0.18</td>
      <td>0.63</td>
      <td>166.5</td>
    </tr>
    <tr>
      <th>12</th>
      <td>996.63</td>
      <td>-8.85</td>
      <td>264.57</td>
      <td>-9.70</td>
      <td>93.5</td>
      <td>3.12</td>
      <td>2.92</td>
      <td>0.20</td>
      <td>1.82</td>
      <td>2.93</td>
      <td>1312.11</td>
      <td>0.16</td>
      <td>0.50</td>
      <td>158.3</td>
    </tr>
    <tr>
      <th>18</th>
      <td>996.87</td>
      <td>-8.84</td>
      <td>264.56</td>
      <td>-9.69</td>
      <td>93.5</td>
      <td>3.13</td>
      <td>2.92</td>
      <td>0.20</td>
      <td>1.83</td>
      <td>2.93</td>
      <td>1312.37</td>
      <td>0.07</td>
      <td>0.25</td>
      <td>129.3</td>
    </tr>
    <tr>
      <th>24</th>
      <td>997.05</td>
      <td>-9.23</td>
      <td>264.15</td>
      <td>-10.25</td>
      <td>92.2</td>
      <td>3.03</td>
      <td>2.79</td>
      <td>0.24</td>
      <td>1.74</td>
      <td>2.80</td>
      <td>1314.62</td>
      <td>0.10</td>
      <td>0.38</td>
      <td>203.9</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_train</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(52569, 14)
</pre></div>
</div>
</div>
</div>
<p>Một lần nữa, để đảm bảo tính nhất quán với tất cả các mô hình dự báo khác trong cuốn sách này, em và anh sẽ sử dụng cùng một tập kiểm tra, chính là hơn 100.000 dữ liệu cuối cùng.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">'../data/test_series.csv'</span><span class="p">)</span>
<span class="n">data_test</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(52569, 15)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x_test</span> <span class="o">=</span> <span class="n">data_test</span><span class="p">[[</span><span class="s1">'p (mbar)'</span><span class="p">,</span> <span class="s1">'Tpot (K)'</span><span class="p">,</span> <span class="s1">'Tdew (degC)'</span><span class="p">,</span> <span class="s1">'H2OC (mmol/mol)'</span><span class="p">,</span> <span class="s1">'rh (%)'</span><span class="p">,</span> <span class="s1">'VPmax (mbar)'</span><span class="p">,</span> <span class="s1">'VPact (mbar)'</span><span class="p">,</span> <span class="s1">'VPdef (mbar)'</span><span class="p">,</span> <span class="s1">'sh (g/kg)'</span><span class="p">,</span> <span class="s1">'rho (g/m**3)'</span><span class="p">,</span> <span class="s1">'wv (m/s)'</span><span class="p">,</span> <span class="s1">'max. wv (m/s)'</span><span class="p">,</span> <span class="s1">'wd (deg)'</span><span class="p">]]</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">data_test</span><span class="p">[[</span><span class="s1">'T (degC)'</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># x_train, x_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=2020)</span>
<span class="n">lr</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
<span class="n">lr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LinearRegression()
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred</span> <span class="o">=</span> <span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">'Mean Absolute Error:'</span><span class="p">,</span> <span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean Absolute Error: 0.0074509637143237
</pre></div>
</div>
</div>
</div>
<p>Chúng ta có thể thấy rằng giá trị sai số MAE là 0.007635891353557461. Điều này có nghĩa là hồi quy tuyến tính hoạt động cực kỳ hiệu quả cho bộ dữ liệu này nếu tất cả các tham số đều được sử dụng. Bây giờ, chúng ta sẽ thử áp dụng các kỹ thuật điều chuẩn (regularization) để xem liệu các sai số có được cải thiện thêm hay không.</p>
<section id="id1">
<h4>L1 Điều chuẩn</h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Lasso Regularization... alpha=0 is equivalent to linear regression</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.linear_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">Lasso</span>
<span class="c1"># X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=2020)</span>
<span class="n">lassoreg2</span> <span class="o">=</span> <span class="n">Lasso</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">model_temp2</span> <span class="o">=</span> <span class="n">lassoreg2</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred3</span> <span class="o">=</span> <span class="n">lassoreg2</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'Mean Absolute Error:'</span><span class="p">,</span> <span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred3</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean Absolute Error: 1.832850814670404
</pre></div>
</div>
</div>
</div>
<p>Dựa trên các chỉ số đo lường, điều chuẩn L1 (Lasso) có hiệu suất kém hơn khi tạo ra các sai số lớn.</p>
</section>
<section id="id2">
<h4>L2 Điều chuẩn</h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ridge Regularization... alpha=0 is equivalent to linear regression</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.linear_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">Ridge</span>
<span class="c1"># X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=2020)</span>

<span class="n">ridgereg2</span> <span class="o">=</span> <span class="n">Ridge</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">model_temp</span> <span class="o">=</span> <span class="n">ridgereg2</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">y_pred2</span> <span class="o">=</span> <span class="n">ridgereg2</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">'Mean Absolute Error:'</span><span class="p">,</span> <span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean Absolute Error: 0.11708568925420408
</pre></div>
</div>
</div>
</div>
<p>Khi sử dụng điều chuẩn L2 (Ridge), việc xử phạt các tham số khác đã không dẫn đến sự cải thiện đáng kể nào trong kết quả dự báo.</p>
</section>
<section id="id3">
<h4>Dự báo đồng thời nhiệt độ trong 24 giờ tới</h4>
<p>Trong phần này, em và anh sẽ thực hiện việc thay đổi cấu trúc dữ liệu (reshape) tương tự như cách chúng ta đã làm ở trên khi áp dụng hồi quy tuyến tính đơn biến. Chúng ta sử dụng một điểm mẫu từ mỗi tập trong số 730 tập kiểm tra (mỗi tập dài 24 giờ) đã được mô tả ở Ví dụ 2 để dự báo nhiệt độ cho 24 giờ tiếp theo.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x_train</span> <span class="o">=</span> <span class="n">data_train</span><span class="p">[[</span><span class="s1">'p (mbar)'</span><span class="p">,</span> <span class="s1">'Tpot (K)'</span><span class="p">,</span> 
                      <span class="s1">'Tdew (degC)'</span><span class="p">,</span> <span class="s1">'H2OC (mmol/mol)'</span><span class="p">,</span> 
                      <span class="s1">'rh (%)'</span><span class="p">,</span> <span class="s1">'VPmax (mbar)'</span><span class="p">,</span> 
                      <span class="s1">'VPact (mbar)'</span><span class="p">,</span> <span class="s1">'VPdef (mbar)'</span><span class="p">,</span> 
                      <span class="s1">'sh (g/kg)'</span><span class="p">,</span> <span class="s1">'rho (g/m**3)'</span><span class="p">,</span> 
                      <span class="s1">'wv (m/s)'</span><span class="p">,</span> <span class="s1">'max. wv (m/s)'</span><span class="p">,</span> 
                      <span class="s1">'wd (deg)'</span><span class="p">]]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">data_train</span><span class="p">)</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">data_train</span><span class="p">)</span><span class="o">%</span><span class="k">24</span>]
<span class="n">y_train</span> <span class="o">=</span> <span class="n">data_train</span><span class="p">[</span><span class="s1">'T (degC)'</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">data_train</span><span class="p">)</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">data_train</span><span class="p">)</span><span class="o">%</span><span class="k">24</span>]

<span class="n">X_new</span> <span class="o">=</span> <span class="n">x_train</span><span class="o">.</span><span class="n">iloc</span><span class="p">[::</span><span class="mi">24</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">y_new</span> <span class="o">=</span> <span class="n">y_train</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">24</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr_sim</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
<span class="n">lr_sim</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_new</span><span class="p">,</span> <span class="n">y_new</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LinearRegression()
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x_test_new</span> <span class="o">=</span> <span class="n">data_test</span><span class="p">[[</span><span class="s1">'p (mbar)'</span><span class="p">,</span> <span class="s1">'Tpot (K)'</span><span class="p">,</span> 
                       <span class="s1">'Tdew (degC)'</span><span class="p">,</span> <span class="s1">'H2OC (mmol/mol)'</span><span class="p">,</span> 
                       <span class="s1">'rh (%)'</span><span class="p">,</span> <span class="s1">'VPmax (mbar)'</span><span class="p">,</span> 
                       <span class="s1">'VPact (mbar)'</span><span class="p">,</span> <span class="s1">'VPdef (mbar)'</span><span class="p">,</span> 
                       <span class="s1">'sh (g/kg)'</span><span class="p">,</span> <span class="s1">'rho (g/m**3)'</span><span class="p">,</span> 
                       <span class="s1">'wv (m/s)'</span><span class="p">,</span> <span class="s1">'max. wv (m/s)'</span><span class="p">,</span> 
                       <span class="s1">'wd (deg)'</span><span class="p">]]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">data_test</span><span class="p">)</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">data_test</span><span class="p">)</span><span class="o">%</span><span class="k">24</span>].iloc[::24].values
<span class="n">y_test_new</span> <span class="o">=</span> <span class="n">data_test</span><span class="p">[[</span><span class="s1">'T (degC)'</span><span class="p">]]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">data_test</span><span class="p">)</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">data_test</span><span class="p">)</span><span class="o">%</span><span class="k">24</span>].values.reshape(-1, 24)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## predict for every 24 hrs in test_series</span>
<span class="n">MAE</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">lr_sim</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_test_new</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_test_new</span><span class="p">)):</span>
    <span class="n">MAE</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test_new</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">y_pred</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"The average Mean Absolute Error is for </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">y_test_new</span><span class="p">)</span><span class="si">}</span><span class="s2"> sets of 24-hr data: "</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">MAE</span><span class="p">)</span><span class="o">/</span><span class="mi">730</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The average Mean Absolute Error is for 730 sets of 24-hr data:  2.8599732777663123
</pre></div>
</div>
</div>
</div>
<p>Chúng ta có thể thấy rằng chỉ số MAE đã được cải thiện đáng kể so với khi chúng ta dự báo nhiệt độ cho 24 giờ tới bằng phương pháp hồi quy tuyến tính (LR) đơn biến.</p>
</section>
</section>
</section>
<section id="du-bao-dong-luong-va-xu-huong" class="tex2jax_process">
<h2 id="du-bao-dong-luong-va-xu-huong-9">Dự báo Động lượng và Xu hướng</h2>
<p>Bây giờ, hãy cùng chuyển sang các công cụ phổ biến trong dự báo động lượng (momentum) và xu hướng (trend). Anh sẽ thấy rằng hai chủ đề này luôn đi đôi với nhau, cụ thể là việc dự báo động lượng thường dựa trên nền tảng của dự báo xu hướng. Trong phần này, chúng ta sẽ thảo luận thông qua việc xem xét các ứng dụng trong phân tích kỹ thuật và chiến lược giao dịch chứng khoán. Trong lĩnh vực này, các công cụ phổ biến nhất được sử dụng là:</p>
<ol class="arabic simple">
<li><p>Đường trung bình động (Moving Average)</p></li>
<li><p>Động lượng (Momentum)</p></li>
</ol>
<section id="duong-trung-binh-dong-moving-average-ma" class="tex2jax_process">
<h3 id="duong-trung-binh-dong-moving-average-ma--10">Đường trung bình động (Moving Average - MA)</h3>
<p class="tex2jax_process">Quy tắc giao dịch dựa trên MA là công cụ phổ biến nhất đối với các nhà giao dịch. Tín hiệu hoặc chỉ báo giao dịch thường được tính toán bằng cách lấy giá đóng cửa trung bình trong một khoảng thời gian (cửa sổ) kích thước <span class="math notranslate nohighlight tex2jax_process">\(n\)</span>, theo công thức sau:</p>
<p class="tex2jax_process"><span class="math notranslate nohighlight tex2jax_process">\(MA_{n}(t) = \frac{w_{0}P_{t}+ w_{1}P_{t-1}+ w_{2}P_{t-2}+...+ w_{n-1}P_{t-n+1}}{w_{0}+ w_{1}+ w_{2}+... + w_{n-1}}\)</span> (1)</p>
<p class="tex2jax_process"><span class="math notranslate nohighlight tex2jax_process">\(MA_{n}(t) = \frac{\sum\limits _{i=0} ^{n-1} w_{i}P_{t-i}}{\sum\limits _{i=0} ^{n-1} w_{i}}\)</span> (2)</p>
<p>Có ba loại đường MA chính như sau:</p>
<ol class="arabic simple tex2jax_process">
<li class="tex2jax_process"><p class="tex2jax_process">Đường trung bình động đơn giản - Simple Moving Average (SMA) - Tất cả các mức giá đều có trọng số bằng nhau, tức là <span class="math notranslate nohighlight tex2jax_process">\(w_{i}=1\)</span> trong các phương trình (1, 2).</p></li>
<li class="tex2jax_process"><p class="tex2jax_process">Đường trung bình động tuyến tính - Linear Moving Average (LMA) - Trọng số thay đổi, tập trung nhiều hơn vào các mức giá gần với giá hiện tại theo công thức <span class="math notranslate nohighlight tex2jax_process">\(w_{i}= n-i\)</span>.</p></li>
<li><p>Đường trung bình động lũy thừa - Exponential Moving Average (EMA) - Tương tự như LMA, trọng số lớn hơn được gán cho các mức giá gần đây nhất và trọng số giảm dần theo hàm mũ. Có nhiều cách để tính trọng số trong EMA, công thức tổng quát thường dùng là:</p></li>
</ol>
<p class="tex2jax_process"><span class="math notranslate nohighlight tex2jax_process">\(EMA(n) = \frac{2}{n+1}P_{t} + (1- \frac{2}{n+1}) P_{t-1}\)</span></p>
<p class="tex2jax_process">Sử dụng các công cụ này, nếu giá hiện tại cao hơn đường trung bình động của <span class="math notranslate nohighlight tex2jax_process">\(n\)</span> kỳ trước đó, tín hiệu sẽ là “Mua” (Buy).</p>
<p class="tex2jax_process">Mặt khác, Động lượng (Momentum) ở dạng đơn giản nhất chỉ là sự chênh lệch giữa giá hiện tại và giá của <span class="math notranslate nohighlight tex2jax_process">\(n\)</span> ngày trước. Trong các định nghĩa khác, nó cũng có thể là sự thay đổi của đường trung bình động đơn giản với hệ số tỷ lệ <span class="math notranslate nohighlight tex2jax_process">\(N+1\)</span>:</p>
<p class="tex2jax_process"><span class="math notranslate nohighlight tex2jax_process">\(\frac{MOM}{N+1} = SMA_{today}- SMA_{yesterday}\)</span></p>
<p>Trong giao dịch, các chỉ báo cho cả hai công cụ được đưa ra là:</p>
<ol class="arabic simple tex2jax_process">
<li class="tex2jax_process"><p class="tex2jax_process">Đường trung bình động - Moving average:
<span class="math notranslate nohighlight tex2jax_process">\(I_{t}(n) = P_{t}- MA_{n}\)</span></p></li>
<li class="tex2jax_process"><p class="tex2jax_process">Động lượng - Momentum
<span class="math notranslate nohighlight tex2jax_process">\(I_{t}(n) = P_{t}-P_{t-n+1}\)</span></p></li>
</ol>
<p class="tex2jax_process">Nhà giao dịch được khuyến nghị mua nếu <span class="math notranslate nohighlight tex2jax_process">\(I&gt;0\)</span> và bán trong trường hợp ngược lại.</p>
<p>Để hiểu sâu hơn các khái niệm này trong phân tích tài chính, chúng ta sẽ xem xét các ví dụ khác nhau trong giao dịch. Nhưng trước tiên, em và anh sẽ sử dụng dữ liệu khí hậu để minh chứng rằng các xu hướng MA cũng được sử dụng để làm mượt (smoothing) dữ liệu chuỗi thời gian. Sau đó, chúng ta sẽ tiếp tục với các ví dụ về phân tích giá cổ phiếu.</p>
</section>
<section id="vi-du-5-trich-xuat-xu-huong-trong-du-lieu-khi-hau-bang-ma">
<h3 id="vi-du-5-trich-xuat-xu-huong-trong-du-lieu-khi-hau--11">Ví dụ 5: Trích xuất xu hướng trong Dữ liệu Khí hậu bằng MA</h3>
<p>Đầu tiên, chúng ta hãy thử áp dụng MA để thấy được xu hướng mượt mà hơn của các phép đo nhiệt độ trong dữ liệu khí hậu. Tại đây, chúng ta sẽ sử dụng MA đơn giản (SMA) và MA lũy thừa (EMA).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 3420 data is equivalent to 1 month while 83220 is equivalent to two years, 124830 for 3 years</span>
<span class="n">data</span><span class="p">[</span><span class="s1">'MA'</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">'T (degC)'</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">6840</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">data</span><span class="p">[</span><span class="s1">'EMA'</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">'T (degC)'</span><span class="p">]</span><span class="o">.</span><span class="n">ewm</span><span class="p">(</span><span class="n">span</span><span class="o">=</span><span class="mi">3420</span><span class="p">,</span> <span class="n">adjust</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">"figure.figsize"</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s1">'T (degC)'</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span> <span class="s1">'Temp'</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s1">'MA'</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span> <span class="s1">'6840MA'</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s1">'EMA'</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span> <span class="s1">'3420EMA'</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">83220</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">'upper left'</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7f84f0ddb610&gt;
</pre></div>
</div>
<img alt="images/b9afd6859076f03c9674d1c6b01c98b366ec8b2f2fe87dbe930364a69dd23b36.png" src="images/b9afd6859076f03c9674d1c6b01c98b366ec8b2f2fe87dbe930364a69dd23b36.png" style="max-width: 100%; height: auto; display: block;">
</div>
</div>
<p>Nhìn vào dữ liệu, chúng ta có thể thấy rằng có một xu hướng theo mùa rõ rệt của các phép đo nhiệt độ. Tại thời điểm này, chúng ta có thể quan tâm đến việc xác định yếu tố nào trong dữ liệu đang gây ra xu hướng nhiệt độ này. Khái niệm này được gọi là quan hệ nhân quả (causation) và sẽ được thảo luận ở một chương sau trong cuốn sách này.</p>
</section>
<section id="chien-luoc-dong-luong-momentum-strategies">
<h3 id="chien-luoc-dong-luong-momentum-strategies--12">Chiến lược Động lượng (Momentum Strategies)</h3>
<p>Động lượng được sử dụng như một thước đo sức mạnh của xu hướng hiện tại hoặc tương lai bất kể hướng đi, nghĩa là liệu nó sẽ tăng hay giảm. Đây thuần túy là một kỹ thuật phân tích kỹ thuật và không xem xét các yếu tố cơ bản của công ty. Các nhà giao dịch sử dụng chiến lược động lượng cho ngắn hạn, khi các xu hướng mạnh hoặc khi động lượng hành động giá cao. Một chỉ báo về động lượng cao là giá tăng hoặc giảm trong một phạm vi rộng trong một khoảng thời gian ngắn. Mức độ động lượng cao cũng cho thấy sự gia tăng của biến động (volatility).</p>
<p>Các nhà đầu tư động lượng cố gắng thấu hiểu và dự đoán hành vi của thị trường, vì nhận thức về các định kiến và cảm xúc của các nhà đầu tư khác giúp chiến lược đầu tư động lượng hoạt động hiệu quả hơn.</p>
<section id="cach-ap-dung-chien-luoc-dong-luong">
<h4>Cách áp dụng chiến lược động lượng:</h4>
<ol class="arabic simple">
<li><p>Nhà giao dịch kiểm tra sự tồn tại của các xu hướng bằng cách sử dụng các chỉ báo như đường xu hướng (trend lines), đường trung bình động (moving averages) và ADX để xác định sự tồn tại của một xu hướng.</p></li>
<li><p>Khi xu hướng có thêm động lượng – mạnh lên – nhà giao dịch quyết định vị thế sẽ thực hiện theo hướng của xu hướng (mua trong một xu hướng tăng; bán trong một xu hướng giảm).</p></li>
<li><p>Nhà giao dịch thoát lệnh khi động lượng của xu hướng có dấu hiệu suy yếu. Sự phân kỳ (divergence) giữa hành động giá và chuyển động của các chỉ báo động lượng như MACD hoặc RSI là một chỉ báo thông thường.</p></li>
</ol>
</section>
</section>
<section id="vi-du-6-chien-luoc-giao-dich-dong-luong-su-dung-hai-duong-ma" class="tex2jax_process">
<h3 id="vi-du-6-chien-luoc-giao-dich-dong-luong-su-dung-ha-13">Ví dụ 6: Chiến lược giao dịch Động lượng sử dụng hai đường MA</h3>
<p>Như đã đề cập ở trên, chiến lược động lượng có thể được áp dụng sau khi kiểm tra các xu hướng bằng cách sử dụng các đường trung bình động. SMA và EMA được sử dụng rộng rãi trong phân tích kỹ thuật giá cổ phiếu và trong việc tạo ra các tín hiệu mua/bán. Ý tưởng cơ bản là sử dụng hai cửa sổ quan sát khác nhau (ngắn hạn và dài hạn) và quan sát điểm giao cắt giữa hai đường MA này. Một cửa sổ ngắn hạn sẽ phản ứng với sự thay đổi giá nhanh hơn so với cửa sổ dài hạn. Do đó, nếu MA(ngắn hạn) &gt; MA(dài hạn), chiến lược hoặc tín hiệu giao dịch là Mua. Ngược lại, tín hiệu sẽ là Bán.</p>
<p class="tex2jax_process">SMA hoạt động tốt trong phân tích kỹ thuật, tuy nhiên, hành vi của nó bị trễ so với giá hiện tại <span class="math notranslate nohighlight tex2jax_process">\(n/2\)</span> ngày. Điều này có nghĩa là những thay đổi trong xu hướng chỉ có thể được nhận thấy sau những ngày trễ này, khiến chiến lược bị trì hoãn. EMA giảm thiểu độ trễ này một cách đáng kể vì các trọng số giảm dần theo hàm mũ. Chiến lược tìm kiếm điểm giao cắt tương tự giữa hai đường EMA với cửa sổ quan sát ngắn hạn và dài hạn luôn được áp dụng, tức là một tín hiệu mua được tạo ra khi đường EMA có cửa sổ ngắn hạn cắt lên trên đường EMA có cửa sổ quan sát dài hạn.</p>
<p>Bây giờ, chúng ta hãy minh họa ý tưởng này bằng cách sử dụng dữ liệu Netflix về cách dùng SMA và EMA trong việc tạo tín hiệu hoặc đưa ra quyết định nên mua hay bán cổ phiếu.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Recall Netflix data we used above in forecasting using linear regression (LR)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">"figure.figsize"</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">price</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Price'</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, 'Price')
</pre></div>
</div>
<img alt="images/8bb965ac847a644abb96aaef1cd22315b5d4cacaed684cdebbac2d4c9366f17b.png" src="images/8bb965ac847a644abb96aaef1cd22315b5d4cacaed684cdebbac2d4c9366f17b.png" style="max-width: 100%; height: auto; display: block;">
</div>
</div>
<p class="tex2jax_process">Chúng ta sẽ sử dụng kích thước cửa sổ <span class="math notranslate nohighlight tex2jax_process">\(n=25\)</span> cho đường MA ngắn hạn và <span class="math notranslate nohighlight tex2jax_process">\(n=65\)</span> cho đường MA dài hạn.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## In pandas, the rolling windows is available in computing for the mean of a window sized-n. </span>
<span class="n">price</span><span class="p">[</span><span class="s1">'20MA'</span><span class="p">]</span> <span class="o">=</span> <span class="n">price</span><span class="p">[</span><span class="s1">'Close'</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">price</span><span class="p">[</span><span class="s1">'65MA'</span><span class="p">]</span> <span class="o">=</span> <span class="n">price</span><span class="p">[</span><span class="s1">'Close'</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">65</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p class="tex2jax_process">Chúng ta sẽ cố gắng xác định điểm giao cắt của hai đường MA và tạo ra một “chỉ báo” giao cắt. Lưu ý rằng chỉ báo này không hoàn toàn giống với chỉ báo “<span class="math notranslate nohighlight tex2jax_process">\(I\)</span>” đã thảo luận ở trên. Sau đó, chúng ta sẽ xây dựng chiến lược dựa trên các chỉ báo đã tạo. Chiến lược này dựa trên sự chuyển động của giá.</p>
<p class="tex2jax_process">Nếu MA25 &gt; MA65, chúng ta có chỉ báo bằng +1.0, ngược lại chỉ báo bằng 0.0. Khi xảy ra giao cắt, sẽ có sự đảo ngược vị trí giữa MA25 và MA65. Do đó, việc lấy hiệu số giữa các chỉ báo (<span class="math notranslate nohighlight tex2jax_process">\(I_{diff} = I_{t} - I_{t-1}\)</span>) tại hai thời điểm liên tiếp sẽ cho chúng ta biết liệu sự đảo chiều đó là tích cực (mua) hay tiêu cực (bán).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">price</span><span class="p">[</span><span class="s1">'Indicator'</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">price</span><span class="p">[</span><span class="s1">'Indicator'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">price</span><span class="p">[</span><span class="s1">'20MA'</span><span class="p">]</span><span class="o">&gt;</span> <span class="n">price</span><span class="p">[</span><span class="s1">'65MA'</span><span class="p">],</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>

<span class="c1"># To get the difference of the indicators, we use function diff in pandas.</span>
<span class="n">price</span><span class="p">[</span><span class="s1">'Decision'</span><span class="p">]</span> <span class="o">=</span> <span class="n">price</span><span class="p">[</span><span class="s1">'Indicator'</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span>
<span class="c1"># print(price)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Decision=+1 means buy, while Decision=-1 means sell</span>
<span class="c1"># plotting them all together </span>
<span class="n">price</span><span class="p">[</span><span class="s1">'Close'</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span> <span class="s1">'Close'</span><span class="p">)</span>
<span class="n">price</span><span class="p">[</span><span class="s1">'20MA'</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="s1">'20MA'</span><span class="p">)</span>
<span class="n">price</span><span class="p">[</span><span class="s1">'65MA'</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="s1">'65MA'</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">price</span><span class="p">[</span><span class="n">price</span><span class="p">[</span><span class="s1">'Decision'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">price</span><span class="p">[</span><span class="s1">'20MA'</span><span class="p">][</span><span class="n">price</span><span class="p">[</span><span class="s1">'Decision'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">'^'</span><span class="p">,</span> <span class="n">markersize</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">'g'</span> <span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">'buy'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">price</span><span class="p">[</span><span class="n">price</span><span class="p">[</span><span class="s1">'Decision'</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">price</span><span class="p">[</span><span class="s1">'20MA'</span><span class="p">][</span><span class="n">price</span><span class="p">[</span><span class="s1">'Decision'</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>  <span class="s1">'v'</span><span class="p">,</span> <span class="n">markersize</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">'r'</span> <span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">'sell'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">'upper left'</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7f84f33ae220&gt;
</pre></div>
</div>
<img alt="images/0bc2dcac216889dfbb9d10eb5d978ebb10656a27527e4ba1c7b4421911ee7bae.png" src="images/0bc2dcac216889dfbb9d10eb5d978ebb10656a27527e4ba1c7b4421911ee7bae.png" style="max-width: 100%; height: auto; display: block;">
</div>
</div>
<p>Sử dụng hai đường MA và xác định điểm giao cắt hoặc hiệu số của chúng làm chỉ báo, chúng ta có thể quyết định nên mua (màu xanh) hay bán (màu đỏ) cổ phiếu. Chúng ta có thể thực hiện quy trình tương tự như trên bằng cách sử dụng đường EMA.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># In pandas, the rolling window equivalent for EMA is </span>
<span class="n">price</span><span class="p">[</span><span class="s1">'20EMA'</span><span class="p">]</span> <span class="o">=</span> <span class="n">price</span><span class="p">[</span><span class="s1">'Close'</span><span class="p">]</span><span class="o">.</span><span class="n">ewm</span><span class="p">(</span><span class="n">span</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">adjust</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">price</span><span class="p">[</span><span class="s1">'65EMA'</span><span class="p">]</span> <span class="o">=</span> <span class="n">price</span><span class="p">[</span><span class="s1">'Close'</span><span class="p">]</span><span class="o">.</span><span class="n">ewm</span><span class="p">(</span><span class="n">span</span><span class="o">=</span><span class="mi">65</span><span class="p">,</span> <span class="n">adjust</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Like how we used MA above, we will try to locate the crossover of the two EMAs and create an indicator of crossover </span>
<span class="n">price</span><span class="p">[</span><span class="s1">'Indicator_EMA'</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">price</span><span class="p">[</span><span class="s1">'Indicator_EMA'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">price</span><span class="p">[</span><span class="s1">'20EMA'</span><span class="p">]</span><span class="o">&gt;</span> <span class="n">price</span><span class="p">[</span><span class="s1">'65EMA'</span><span class="p">],</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>

<span class="n">price</span><span class="p">[</span><span class="s1">'Decision_EMA'</span><span class="p">]</span> <span class="o">=</span> <span class="n">price</span><span class="p">[</span><span class="s1">'Indicator_EMA'</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span>
<span class="c1"># print(price)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Decision=+1 means buy, while Decision=-1 means sell</span>
<span class="c1"># plotting them all together </span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">"figure.figsize"</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">price</span><span class="p">[</span><span class="s1">'Close'</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span> <span class="s1">'Close'</span><span class="p">)</span>
<span class="n">price</span><span class="p">[</span><span class="s1">'20EMA'</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="s1">'20EMA'</span><span class="p">)</span>
<span class="n">price</span><span class="p">[</span><span class="s1">'65EMA'</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="s1">'65EMA'</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">price</span><span class="p">[</span><span class="n">price</span><span class="p">[</span><span class="s1">'Decision_EMA'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">price</span><span class="p">[</span><span class="s1">'20EMA'</span><span class="p">][</span><span class="n">price</span><span class="p">[</span><span class="s1">'Decision_EMA'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">'^'</span><span class="p">,</span> <span class="n">markersize</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">'g'</span> <span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">'buy'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">price</span><span class="p">[</span><span class="n">price</span><span class="p">[</span><span class="s1">'Decision_EMA'</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">price</span><span class="p">[</span><span class="s1">'20EMA'</span><span class="p">][</span><span class="n">price</span><span class="p">[</span><span class="s1">'Decision_EMA'</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>  <span class="s1">'v'</span><span class="p">,</span> <span class="n">markersize</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">'r'</span> <span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">'sell'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">'upper left'</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7f84f4caff70&gt;
</pre></div>
</div>
<img alt="images/a92229d511f019a364838529be5e14a32dc0fd86203c0912419fb3edc0f86c60.png" src="images/a92229d511f019a364838529be5e14a32dc0fd86203c0912419fb3edc0f86c60.png" style="max-width: 100%; height: auto; display: block;">
</div>
</div>
<p>Đối với trường hợp này, các chỉ báo động lượng nhìn chung giúp chúng ta đưa ra quyết định có nên mua hay không. Điểm giao cắt là dấu hiệu của sự đảo chiều xu hướng. Trong bối cảnh phân tích kỹ thuật, lệnh “Mua” dự báo rằng giá sẽ tăng, trong khi lệnh “Bán” dự báo rằng giá sẽ giảm.</p>
<p>Các công cụ này hoạt động hiệu quả trong các trường hợp tổng quát, tuy nhiên vẫn còn những công cụ tinh vi hơn có thể được sử dụng trong việc thực hiện phân tích kỹ thuật.</p>
</section>
<section id="vi-du-7-chien-luoc-giao-dich-dong-luong-su-dung-macd">
<h3 id="vi-du-7-chien-luoc-giao-dich-dong-luong-su-dung-ma-14">Ví dụ 7: Chiến lược giao dịch Động lượng sử dụng MACD</h3>
<p>Có rất nhiều chiến lược giao dịch động lượng có thể được sử dụng. Trong ví dụ này, chúng ta sẽ sử dụng đường trung bình động hội tụ phân kỳ (MACD). MACD là một trong những chỉ báo động lượng phổ biến nhất, sử dụng hiệu số giữa hai đường trung bình động lũy thừa (EMA 12 ngày và EMA 26 ngày) và so sánh nó với đường EMA 9 ngày của chính MACD (được gọi là đường tín hiệu).</p>
<section id="cac-chi-bao-macd">
<h4>Các chỉ báo MACD</h4>
<ol class="arabic simple">
<li><p>Giao cắt tăng giá (Mua): Xảy ra khi đường MACD cắt lên trên đường tín hiệu (signal line).</p></li>
<li><p>Tín hiệu giảm giá (Bán): Xảy ra khi đường MACD cắt xuống dưới đường tín hiệu.</p></li>
<li><p>Quá mua hoặc quá bán: Xảy ra khi điểm giao cắt có đường MACD với độ dốc cao, tùy thuộc vào việc đó là giao cắt tăng giá hay giảm giá. Một sự điều chỉnh hoặc đảo chiều xu hướng sẽ sớm theo sau.</p></li>
<li><p>Về chuyển động: Chuyển động yếu, được biểu thị bởi độ dốc nhỏ của MACD, có khả năng cao sẽ điều chỉnh; trong khi chuyển động mạnh có xác suất cao sẽ tiếp tục xu hướng.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">price</span><span class="p">[</span><span class="s1">'exp1'</span><span class="p">]</span> <span class="o">=</span> <span class="n">price</span><span class="p">[</span><span class="s1">'Close'</span><span class="p">]</span><span class="o">.</span><span class="n">ewm</span><span class="p">(</span><span class="n">span</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">adjust</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">price</span><span class="p">[</span><span class="s1">'exp2'</span><span class="p">]</span> <span class="o">=</span> <span class="n">price</span><span class="p">[</span><span class="s1">'Close'</span><span class="p">]</span><span class="o">.</span><span class="n">ewm</span><span class="p">(</span><span class="n">span</span><span class="o">=</span><span class="mi">26</span><span class="p">,</span> <span class="n">adjust</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">price</span><span class="p">[</span><span class="s1">'macd'</span><span class="p">]</span> <span class="o">=</span> <span class="n">price</span><span class="p">[</span><span class="s1">'exp1'</span><span class="p">]</span><span class="o">-</span><span class="n">price</span><span class="p">[</span><span class="s1">'exp2'</span><span class="p">]</span>
<span class="n">price</span><span class="p">[</span><span class="s1">'exp3'</span><span class="p">]</span> <span class="o">=</span> <span class="n">price</span><span class="p">[</span><span class="s1">'macd'</span><span class="p">]</span><span class="o">.</span><span class="n">ewm</span><span class="p">(</span><span class="n">span</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">adjust</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="n">price</span><span class="p">[</span><span class="s1">'macd'</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="s1">'g'</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">'MACD'</span><span class="p">)</span>
<span class="n">price</span><span class="p">[</span><span class="s1">'exp3'</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="s1">'r'</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">'Signal'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">'upper left'</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="images/a0e006eba9aab7c572594af7448fa04814fabc994f60f80824bc8cf2508cee25.png" src="images/a0e006eba9aab7c572594af7448fa04814fabc994f60f80824bc8cf2508cee25.png" style="max-width: 100%; height: auto; display: block;">
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Like how we used MA above, we will try to locate the crossover of the MACD and the Signal and plot the indicators </span>
<span class="n">price</span><span class="p">[</span><span class="s1">'Indicator_MACD'</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">price</span><span class="p">[</span><span class="s1">'Indicator_MACD'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">price</span><span class="p">[</span><span class="s1">'macd'</span><span class="p">]</span><span class="o">&gt;</span> <span class="n">price</span><span class="p">[</span><span class="s1">'exp3'</span><span class="p">],</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>

<span class="n">price</span><span class="p">[</span><span class="s1">'Decision_MACD'</span><span class="p">]</span> <span class="o">=</span> <span class="n">price</span><span class="p">[</span><span class="s1">'Indicator_MACD'</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span>
<span class="c1"># print(price)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">price</span><span class="p">[</span><span class="s1">'macd'</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="s1">'g'</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">'MACD'</span><span class="p">)</span>
<span class="n">price</span><span class="p">[</span><span class="s1">'exp3'</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="s1">'r'</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">'Signal'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">'upper left'</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">price</span><span class="p">[</span><span class="n">price</span><span class="p">[</span><span class="s1">'Decision_MACD'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">price</span><span class="p">[</span><span class="s1">'macd'</span><span class="p">][</span><span class="n">price</span><span class="p">[</span><span class="s1">'Decision_MACD'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">'^'</span><span class="p">,</span> <span class="n">markersize</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">'g'</span> <span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">'buy'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">price</span><span class="p">[</span><span class="n">price</span><span class="p">[</span><span class="s1">'Decision_MACD'</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">price</span><span class="p">[</span><span class="s1">'macd'</span><span class="p">][</span><span class="n">price</span><span class="p">[</span><span class="s1">'Decision_MACD'</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>  <span class="s1">'v'</span><span class="p">,</span> <span class="n">markersize</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">'r'</span> <span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">'sell'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">'upper left'</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7f84f4e1e3d0&gt;
</pre></div>
</div>
<img alt="images/021ad6011e7877b68a8da8c3686956045c28d118f9e95359d4d758cca8da6ede.png" src="images/021ad6011e7877b68a8da8c3686956045c28d118f9e95359d4d758cca8da6ede.png" style="max-width: 100%; height: auto; display: block;">
</div>
</div>
<p>Trong biểu đồ trên, chúng ta có thể thấy các ngày ước tính diễn ra sự giao cắt tăng giá (mua) và giao cắt giảm giá (bán). Bây giờ, chúng ta muốn kiểm tra cường độ và xác định các điều kiện quá mua (overbought) và quá bán (oversold). Tại đây, chúng ta sử dụng cùng các tham số đó, nhưng sẽ vẽ biểu đồ giá gốc và đường MACD của nó.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">price</span><span class="p">[</span><span class="s1">'Close'</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="s1">'k'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span> <span class="s1">'Close'</span><span class="p">)</span>
<span class="n">price</span><span class="p">[</span><span class="s1">'macd'</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="s1">'g'</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">'MACD'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="images/fbc16b2d6e60bd1fc7e0ef4d3e9cff61bf2520a25562906e1ff27b46f59a96b9.png" src="images/fbc16b2d6e60bd1fc7e0ef4d3e9cff61bf2520a25562906e1ff27b46f59a96b9.png" style="max-width: 100%; height: auto; display: block;">
</div>
</div>
<p>Tại đây, MACD duy trì trạng thái tương đối phẳng, nhưng hãy lưu ý rằng có những thời điểm đường cong MACD dốc hơn so với các thời điểm khác, biểu thị các điều kiện quá mua hoặc quá bán (ví dụ: trước thời điểm 2020-04). Phóng to biểu đồ MACD để quan sát độ dốc, chúng ta có kết quả như sau:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">'Close Price'</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">'MACD'</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">price</span><span class="p">[</span><span class="s1">'Close'</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Close'</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">price</span><span class="p">[</span><span class="s1">'macd'</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">'macd'</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">'Date'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="images/a67f51b3604e6ea9b6640f83d9367da5a970a31e4cde8630182a5b9aae0904de.png" src="images/a67f51b3604e6ea9b6640f83d9367da5a970a31e4cde8630182a5b9aae0904de.png" style="max-width: 100%; height: auto; display: block;">
</div>
</div>
<p>Từ các biểu đồ trên, các độ dốc lớn của MACD đã xảy ra trước thời điểm 2020-04 (quá bán) và 2020-10 (quá mua). Lưu ý rằng vẫn còn một số vị trí có độ dốc lớn trong MACD sau thời điểm 2020-07, và chúng có thể là dấu hiệu của các trường hợp quá mua và quá bán khác.</p>
<p>Cuối cùng, như đã thảo luận ở trên, còn có các chỉ báo động lượng khác được sử dụng trong giao dịch như RSI (Chỉ số sức mạnh tương đối) và ADX (Chỉ số định hướng trung bình). Người đọc có thể tự tìm hiểu thêm về chúng theo quy trình đã được trình bày trong cuốn sách này.</p>
</section>
</section>
</section>

</section>
    </article>
    
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const fixRawMath = () => {
        if (window.MathJax && window.MathJax.typeset) {
            window.MathJax.typeset();
        }
      };
      setTimeout(fixRawMath, 1000);

      document.querySelectorAll('a[href^="#"]').forEach(anchor => {
          anchor.addEventListener('click', function (e) {
              const href = this.getAttribute('href');
              if (href === '#' || !href.startsWith('#')) return;
              e.preventDefault();
              const targetId = href.slice(1);
              const targetElement = document.getElementById(targetId);
              if (targetElement) {
                  window.scrollTo({
                      top: targetElement.offsetTop - 40,
                      behavior: 'smooth'
                  });
              }
          });
      });
    });
  </script>

</body>
</html>